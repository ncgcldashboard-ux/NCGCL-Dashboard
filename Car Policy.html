<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Vehicle Policy Strategy Optimization (HTML + JS)</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    /* Keep it tidy */
    .card { @apply bg-white rounded-xl shadow-sm border border-slate-200; }
  </style>
</head>

<body class="min-h-screen bg-slate-50 font-sans text-slate-800 p-4 md:p-8">
  <div class="max-w-6xl mx-auto space-y-8">

    <!-- Header -->
    <header class="text-center space-y-4">
      <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900 tracking-tight">
        Vehicle Policy Strategy <span class="text-emerald-600">Optimization</span>
      </h1>
      <p class="text-slate-500 max-w-2xl mx-auto text-lg">
        Comparing the financial efficiency of Car Monetization (Allowance) vs. Company Owned Vehicles.
      </p>
    </header>

    <!-- Grade Selector -->
    <div id="gradeSelector" class="flex justify-center flex-wrap gap-2"></div>

    <!-- Main Stats Display -->
    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 grid md:grid-cols-3 gap-6 items-center">
      <div class="md:col-span-1 space-y-1">
        <span class="text-sm font-medium text-slate-400 uppercase tracking-wider">Selected Vehicle</span>
        <div class="text-2xl font-bold text-slate-800" id="vehicleName">—</div>
        <div class="text-sm text-slate-500">Market Price: PKR <span id="vehiclePrice">—</span>mn</div>
      </div>

      <div class="md:col-span-2 grid grid-cols-2 gap-4">
        <div class="bg-red-50 rounded-xl p-4 border border-red-100">
          <span class="text-xs font-semibold text-red-600 uppercase">Scenario A (Monetization)</span>
          <div class="text-2xl font-bold text-red-700">PKR <span id="scenarioA">—</span>mn</div>
          <span class="text-xs text-red-500">Net Present Value (5 Years)</span>
        </div>
        <div class="bg-emerald-50 rounded-xl p-4 border border-emerald-100">
          <span class="text-xs font-semibold text-emerald-600 uppercase">Scenario B (Company Owned)</span>
          <div class="text-2xl font-bold text-emerald-700">PKR <span id="scenarioB">—</span>mn</div>
          <span class="text-xs text-emerald-500">Net Present Value (5 Years)</span>
        </div>
      </div>
    </div>

    <!-- Visual Flow Comparison -->
    <div class="grid lg:grid-cols-2 gap-8">

      <!-- Scenario A -->
      <div class="relative p-6 rounded-xl border-2 border-slate-200 bg-white shadow-lg transition-all hover:shadow-xl h-full">
        <div class="flex items-center gap-3 mb-4 text-red-600">
          <div class="p-3 rounded-lg bg-red-100">
            <!-- banknote-ish icon -->
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M3 7h18v10H3z" stroke="currentColor" stroke-width="2"/>
              <path d="M7 10h.01M17 14h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-slate-800">Scenario A: Monetization</h3>
        </div>

        <div class="space-y-6">
          <div class="bg-red-50 p-3 rounded-lg text-sm text-red-800 font-medium flex gap-2">
            <svg class="w-5 h-5 shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
              <path d="M12 8h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M11 12h1v4h1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            High tax leakage reduces efficiency.
          </div>

          <!-- Flowchart A -->
          <div class="flex items-center justify-between relative py-4">
            <!-- Company -->
            <div class="flex flex-col items-center text-center w-24">
              <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center mb-2 border border-slate-200">
                <svg class="w-6 h-6 text-slate-600" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M4 20V4h10v16" stroke="currentColor" stroke-width="2"/>
                  <path d="M14 9h6v11" stroke="currentColor" stroke-width="2"/>
                  <path d="M8 8h2M8 12h2M8 16h2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <span class="text-xs font-bold text-slate-700">Company</span>
              <span class="text-[10px] text-slate-500 leading-tight">Pays Allowance</span>
            </div>

            <!-- Arrow -->
            <div class="flex flex-col items-center justify-center flex-1 px-2">
              <span class="text-[10px] font-semibold text-red-500 mb-1">Cash</span>
              <div class="h-[2px] w-full bg-red-300 relative">
                <div class="absolute right-0 -top-[3px] w-2 h-2 border-t-2 border-r-2 border-red-300 rotate-45"></div>
              </div>
            </div>

            <!-- Employee -->
            <div class="relative flex flex-col items-center text-center w-24">
              <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center mb-2 border border-slate-200">
                <svg class="w-6 h-6 text-slate-600" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M4 20a8 8 0 0 1 16 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <span class="text-xs font-bold text-slate-700">Employee</span>
              <span class="text-[10px] text-slate-500 leading-tight">Receives Income</span>

              <div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-red-100 text-red-700 px-2 py-1 rounded text-[10px] font-bold border border-red-200 whitespace-nowrap">
                Taxed as Salary (~35%)
              </div>
            </div>

            <!-- Arrow -->
            <div class="flex flex-col items-center justify-center flex-1 px-2">
              <span class="text-[10px] font-semibold text-red-500 mb-1">Post-Tax Cash</span>
              <div class="h-[2px] w-full bg-red-300 relative">
                <div class="absolute right-0 -top-[3px] w-2 h-2 border-t-2 border-r-2 border-red-300 rotate-45"></div>
              </div>
            </div>

            <!-- Dealer -->
            <div class="flex flex-col items-center text-center w-24">
              <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center mb-2 border border-slate-200">
                <svg class="w-6 h-6 text-slate-600" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M3 16l1-5 3-3h10l3 3 1 5" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M7 16v2M17 16v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M6.5 16a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Zm11 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z" stroke="currentColor" stroke-width="2"/>
                </svg>
              </div>
              <span class="text-xs font-bold text-slate-700">Dealer</span>
              <span class="text-[10px] text-slate-500 leading-tight">Purchase</span>
            </div>
          </div>

          <div class="space-y-3 pt-4 border-t border-slate-100 text-sm">
            <p class="text-slate-600">
              <span class="font-bold text-red-600">The Problem:</span>
              The company pays a grossed-up allowance every month. A large portion goes to the government as income tax
              before the employee can pay for the car.
            </p>
          </div>
        </div>
      </div>

      <!-- Scenario B -->
      <div class="relative p-6 rounded-xl border-2 border-emerald-500 bg-emerald-50/50 shadow-lg transition-all hover:shadow-xl h-full">
        <div class="absolute -top-3 right-4 bg-emerald-500 text-white text-xs font-bold px-3 py-1 rounded-full flex items-center gap-1">
          <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M20 7l-9 10-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          RECOMMENDED
        </div>

        <div class="flex items-center gap-3 mb-4 text-emerald-600">
          <div class="p-3 rounded-lg bg-emerald-100">
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 20V4h10v16" stroke="currentColor" stroke-width="2"/>
              <path d="M14 9h6v11" stroke="currentColor" stroke-width="2"/>
              <path d="M8 8h2M8 12h2M8 16h2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-slate-800">Scenario B: Company Owned</h3>
        </div>

        <div class="space-y-6">
          <div class="bg-emerald-50 p-3 rounded-lg text-sm text-emerald-800 font-medium flex gap-2">
            <svg class="w-5 h-5 shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M20 7l-9 10-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Optimized for tax shield and asset recovery.
          </div>

          <!-- Flowchart B -->
          <div class="flex items-center justify-between relative py-4">
            <!-- Company -->
            <div class="flex flex-col items-center text-center w-24">
              <div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center mb-2 border border-emerald-200">
                <svg class="w-6 h-6 text-emerald-600" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M4 20V4h10v16" stroke="currentColor" stroke-width="2"/>
                  <path d="M14 9h6v11" stroke="currentColor" stroke-width="2"/>
                </svg>
              </div>
              <span class="text-xs font-bold text-slate-700">Company</span>
              <span class="text-[10px] text-slate-500 leading-tight">Owns Asset</span>
            </div>

            <!-- Arrow -->
            <div class="flex flex-col items-center justify-center flex-1 px-2">
              <span class="text-[10px] font-semibold text-emerald-500 mb-1">Purchase</span>
              <div class="h-[2px] w-full bg-emerald-300 relative">
                <div class="absolute right-0 -top-[3px] w-2 h-2 border-t-2 border-r-2 border-emerald-300 rotate-45"></div>
              </div>
            </div>

            <!-- Asset -->
            <div class="relative flex flex-col items-center text-center w-24">
              <div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center mb-2 border border-emerald-200">
                <svg class="w-6 h-6 text-emerald-600" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M3 16l1-5 3-3h10l3 3 1 5" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M6.5 16a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Zm11 0a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3Z" stroke="currentColor" stroke-width="2"/>
                </svg>
              </div>
              <span class="text-xs font-bold text-slate-700">Asset</span>
              <span class="text-[10px] text-slate-500 leading-tight">Depreciating</span>

              <div class="absolute -top-8 left-1/2 -translate-x-1/2 bg-emerald-100 text-emerald-700 px-2 py-1 rounded text-[10px] font-bold border border-emerald-200 whitespace-nowrap flex items-center gap-1">
                <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M12 2l7 4v6c0 5-3 9-7 10-4-1-7-5-7-10V6l7-4Z"
                        stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                Tax Shield
              </div>
            </div>

            <!-- Arrow -->
            <div class="flex flex-col items-center justify-center flex-1 px-2">
              <span class="text-[10px] font-semibold text-emerald-500 mb-1">Usage</span>
              <div class="h-[2px] w-full bg-emerald-300 relative">
                <div class="absolute right-0 -top-[3px] w-2 h-2 border-t-2 border-r-2 border-emerald-300 rotate-45"></div>
              </div>
            </div>

            <!-- Employee -->
            <div class="flex flex-col items-center text-center w-24">
              <div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center mb-2 border border-emerald-200">
                <svg class="w-6 h-6 text-emerald-600" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M4 20a8 8 0 0 1 16 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <span class="text-xs font-bold text-slate-700">Employee</span>
              <span class="text-[10px] text-slate-500 leading-tight">Low Tax</span>
            </div>
          </div>

          <div class="space-y-3 pt-4 border-t border-slate-100 text-sm">
            <p class="text-slate-600">
              <span class="font-bold text-emerald-600">The Solution:</span>
              Company buys the asset. Depreciation reduces corporate tax. Employee pays minimal tax on benefit value.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="grid lg:grid-cols-2 gap-8">

      <!-- Annual Cash Flow Chart -->
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
            <svg class="w-5 h-5 text-slate-500" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 19V5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M4 19h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M8 17v-6M12 17v-10M16 17v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Yearly Company Cash Outflow
          </h3>
          <span class="text-xs text-slate-400 bg-slate-100 px-2 py-1 rounded">PKR Million</span>
        </div>
        <div class="h-64 w-full">
          <canvas id="annualChart"></canvas>
        </div>
        <div class="mt-4 text-xs text-slate-500 text-center italic">
          *Scenario B Year 5 may show net inflow (negative) due to asset salvage value recovery.
        </div>
      </div>

      <!-- Total Cost Comparison Chart -->
      <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
            <svg class="w-5 h-5 text-slate-500" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M11 3h2v18h-2z" fill="currentColor"/>
              <path d="M3 11h18v2H3z" fill="currentColor"/>
            </svg>
            Total 5-Year Cost (NPV)
          </h3>
          <span class="text-xs text-slate-400 bg-slate-100 px-2 py-1 rounded">PKR Million</span>
        </div>
        <div class="h-64 w-full">
          <canvas id="npvChart"></canvas>
        </div>
        <div class="mt-4 text-xs text-slate-500 text-center italic">
          Comparing total Net Present Value cost across all grades.
        </div>
      </div>

    </div>

    <!-- Key Takeaways -->
    <div class="grid md:grid-cols-3 gap-6">
      <div class="bg-blue-50 p-6 rounded-xl border border-blue-100 flex flex-col items-center text-center">
        <div class="p-3 bg-blue-100 rounded-full mb-3 text-blue-600">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M3 7l4 4 6-6 8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 7v6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <h4 class="font-bold text-slate-800 mb-2">Lower Cash Outflow</h4>
        <p class="text-sm text-slate-600">Company saves ~30% in NPV terms due to asset recovery and tax efficiency.</p>
      </div>

      <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100 flex flex-col items-center text-center">
        <div class="p-3 bg-indigo-100 rounded-full mb-3 text-indigo-600">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 2v20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M7 7h7a3 3 0 0 1 0 6H9a3 3 0 0 0 0 6h8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h4 class="font-bold text-slate-800 mb-2">Better Tax Efficiency</h4>
        <p class="text-sm text-slate-600">Depreciation acts as a tax shield, lowering the effective corporate tax burden.</p>
      </div>

      <div class="bg-purple-50 p-6 rounded-xl border border-purple-100 flex flex-col items-center text-center">
        <div class="p-3 bg-purple-100 rounded-full mb-3 text-purple-600">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M12 2l7 4v6c0 5-3 9-7 10-4-1-7-5-7-10V6l7-4Z"
                  stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h4 class="font-bold text-slate-800 mb-2">Risk Mitigation</h4>
        <p class="text-sm text-slate-600">Centralized ownership ensures compliance, insurance coverage, and asset quality.</p>
      </div>
    </div>

  </div>
<!-- Policy Disclaimer -->
<div class="bg-amber-50 p-6 rounded-2xl border border-amber-200">
  <h3 class="text-lg font-bold text-slate-800 mb-3 flex items-center gap-2">
    <svg class="w-5 h-5 text-amber-600" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M12 9v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M12 17h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z"
            stroke="currentColor" stroke-width="2"/>
    </svg>
    Disclaimer and Key Assumptions
  </h3>

  <ul class="list-disc pl-5 space-y-2 text-sm text-slate-700">
    <li>
      <span class="font-semibold">Cessation of Monetization Allowance:</span>
      The car monetization allowance shall cease immediately once an employee is allotted or provided with a company-owned vehicle.
      Concurrent receipt of a company vehicle and monetization allowance is not permitted.
    </li>

    <li>
      <span class="font-semibold">Evaluation Assumption – Allowance Stability:</span>
      For evaluation and comparative analysis purposes, the car monetization allowance is assumed to remain flat and unchanged
      over a five (5) year period, with no escalation or inflationary adjustment.
    </li>

    <li>
      <span class="font-semibold">Fuel Allowance Treatment:</span>
      Employees are already entitled to a separate fuel allowance under the existing benefits framework.
      Fuel costs are therefore excluded from the car monetization allowance and from all scenario comparisons.
    </li>
  </ul>
</div>

  
<script>
  // -------------------------
  // Data (from your React file)
  // -------------------------
  const vehicleData = {
    10: { grade: "Grade 10", vehicle: "Honda Civic RS 1.6", price: 10.58, scenarioA: 8.49, scenarioB: 6.07, savings: 2.42, percentSave: 28.5 },
    9:  { grade: "Grade 9",  vehicle: "Toyota Corolla Altis 1.6", price: 7.04, scenarioA: 6.07, scenarioB: 4.05, savings: 2.02, percentSave: 33.3 },
    8:  { grade: "Grade 8",  vehicle: "Honda City 1.5 Auto", price: 6.37, scenarioA: 5.40, scenarioB: 3.66, savings: 1.74, percentSave: 32.2 },
    7:  { grade: "Grade 7",  vehicle: "Toyota Yaris CVT 1.3", price: 5.07, scenarioA: 4.07, scenarioB: 2.91, savings: 1.16, percentSave: 28.5 },
    6:  { grade: "Grade 6",  vehicle: "Kia Picanto", price: 4.21, scenarioA: 3.56, scenarioB: 2.42, savings: 1.14, percentSave: 32.0 }
  };

  // Used in the 5-year NPV comparison chart (horizontal in React; we'll do vertical bars)
  const npvComparisonData = Object.values(vehicleData)
    .map(d => ({ grade: d.grade, Monetization: d.scenarioA, CompanyOwned: d.scenarioB }))
    .reverse();

  let activeGrade = 10;

  // -------------------------
  // Year-by-year data logic (mirrors your useMemo)
  // -------------------------
  function buildYearlyData(data) {
    // Approximations copied from your file
    const annualAllowance = (data.scenarioA / 3.4);      // proxy annuity factor
    const maintenance = data.price * 0.02;               // annual maint/insurance
    const salvageValue = data.price * 0.45;              // year-5 residual recovery

    // In PKR million
    return [
      { year: "Year 1", Monetization: +annualAllowance.toFixed(2), CompanyOwned: +(data.price + maintenance).toFixed(2) },
      { year: "Year 2", Monetization: +annualAllowance.toFixed(2), CompanyOwned: +maintenance.toFixed(2) },
      { year: "Year 3", Monetization: +annualAllowance.toFixed(2), CompanyOwned: +maintenance.toFixed(2) },
      { year: "Year 4", Monetization: +annualAllowance.toFixed(2), CompanyOwned: +maintenance.toFixed(2) },
      { year: "Year 5", Monetization: +annualAllowance.toFixed(2), CompanyOwned: +(maintenance - salvageValue).toFixed(2) } // negative possible
    ];
  }

  // -------------------------
  // Charts (Chart.js)
  // -------------------------
  let annualChart;
  let npvChart;

  function initCharts() {
    // Annual chart
    const annualCtx = document.getElementById("annualChart").getContext("2d");
    annualChart = new Chart(annualCtx, {
      type: "bar",
      data: {
        labels: [],
        datasets: [
          { label: "Monetization (Outflow)", data: [], borderWidth: 0 },
          { label: "Company Owned (Net Flow)", data: [], borderWidth: 0 }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: "index", intersect: false },
        plugins: {
          legend: { position: "top", labels: { usePointStyle: true, pointStyle: "circle" } },
          tooltip: {
            callbacks: {
              label: (ctx) => `${ctx.dataset.label}: PKR ${ctx.parsed.y.toFixed(2)}mn`
            }
          }
        },
        scales: {
          x: { grid: { display: false }, ticks: { color: "#64748b" } },
          y: {
            grid: { color: "#e2e8f0" },
            ticks: { color: "#64748b" }
          }
        }
      }
    });

    // NPV chart
    const npvCtx = document.getElementById("npvChart").getContext("2d");
    npvChart = new Chart(npvCtx, {
      type: "bar",
      data: {
        labels: npvComparisonData.map(d => d.grade),
        datasets: [
          { label: "Scenario A: Monetization", data: npvComparisonData.map(d => d.Monetization), borderWidth: 0 },
          { label: "Scenario B: Company Owned", data: npvComparisonData.map(d => d.CompanyOwned), borderWidth: 0 }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: "index", intersect: false },
        plugins: {
          legend: { position: "top", labels: { usePointStyle: true, pointStyle: "circle" } },
          tooltip: {
            callbacks: {
              label: (ctx) => `${ctx.dataset.label}: PKR ${ctx.parsed.y.toFixed(2)}mn`
            }
          }
        },
        scales: {
          x: { grid: { color: "#e2e8f0" }, ticks: { color: "#64748b" } },
          y: { grid: { color: "#e2e8f0" }, ticks: { color: "#64748b" } }
        }
      }
    });
  }

  function updateAnnualChart(yearlyData) {
    annualChart.data.labels = yearlyData.map(d => d.year);
    annualChart.data.datasets[0].data = yearlyData.map(d => d.Monetization);
    annualChart.data.datasets[1].data = yearlyData.map(d => d.CompanyOwned);
    annualChart.update();
  }

  // -------------------------
  // UI render
  // -------------------------
  function renderGradeButtons() {
    const container = document.getElementById("gradeSelector");
    container.innerHTML = "";

    Object.keys(vehicleData).sort((a, b) => b - a).forEach(g => {
      const btn = document.createElement("button");
      const isActive = Number(g) === Number(activeGrade);

      btn.className = [
        "px-4 py-2 rounded-full font-semibold transition-all",
        isActive
          ? "bg-slate-800 text-white shadow-lg scale-105"
          : "bg-white text-slate-600 hover:bg-slate-100 border border-slate-200"
      ].join(" ");

      btn.textContent = `Grade ${g}`;
      btn.addEventListener("click", () => {
        activeGrade = Number(g);
        renderAll();
      });
      container.appendChild(btn);
    });
  }

  function renderStats(data) {
    document.getElementById("vehicleName").textContent = data.vehicle;
    document.getElementById("vehiclePrice").textContent = data.price.toFixed(2);
    document.getElementById("scenarioA").textContent = data.scenarioA.toFixed(2);
    document.getElementById("scenarioB").textContent = data.scenarioB.toFixed(2);
  }

  function renderAll() {
    const data = vehicleData[activeGrade];
    renderGradeButtons();
    renderStats(data);

    const yearly = buildYearlyData(data);
    updateAnnualChart(yearly);
  }

  // Boot
  initCharts();
  renderAll();
</script>
</body>
</html>
